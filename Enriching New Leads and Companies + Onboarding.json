{
  "name": "Enriching New Leads and Companies + Onboarding",
  "nodes": [
    {
      "parameters": {
        "authentication": "appToken",
        "email": "={{ $json.workEmail }}",
        "additionalFields": {
          "associatedCompanyId": "={{ $('Create Company on HubSpot').first().json.companyId }}",
          "city": "={{ $json.city }}",
          "companyName": "={{ $json.currentCompany }}",
          "companySize": "={{ $json.scoreReasons }}",
          "customPropertiesUi": {
            "customPropertiesValues": [
              {
                "property": "lead_score",
                "value": "={{ $json.totalLeadScore }}"
              },
              {
                "property": "company_id",
                "value": "={{ $json.productInterest }}"
              },
              {
                "property": "contact_id",
                "value": "={{ $json.about }}"
              },
              {
                "property": "utm_campaign",
                "value": "={{ $json.latestLinkedinActivity }}"
              }
            ]
          },
          "degree": "={{ $json.latestCertification }}",
          "firstName": "={{ $json.firstName }}",
          "jobTitle": "={{ $json.jobTitle }}",
          "lastName": "={{ $json.lastName }}",
          "linkedinUrl": "={{ $json.linkedinURL }}",
          "maritalStatus": "={{ $json.challengeText }}",
          "phoneNumber": "={{ $json.phoneNumber }}",
          "school": "={{ $json.educationDetails }}",
          "seniority": "={{ $json.totalYearsAtCompany }}",
          "workEmail": "={{ $json.workEmail }}"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        2064,
        1936
      ],
      "id": "5a6d6058-778f-43b7-b181-a4669d8b9b6f",
      "name": "Create or Update a Contact in HubSpot",
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "authentication": "appToken",
        "operation": "search",
        "limit": 10,
        "filterGroupsUi": {
          "filterGroupsValues": [
            {
              "filtersUi": {
                "filterValues": [
                  {
                    "propertyName": "email|string",
                    "operator": "CONTAINS_TOKEN",
                    "value": "={{ $(\"Webhook: Contact Form New Submission\").first().json.body[\"Work Email\"] }}"
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "properties": [
            "email"
          ]
        }
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        224,
        1936
      ],
      "id": "f8e4bae1-aafc-4f99-91a6-7838c75e271a",
      "name": "Check If Lead Already Exists in HubSpot",
      "alwaysOutputData": true,
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "authentication": "appToken",
        "resource": "company",
        "operation": "searchByDomain",
        "domain": "={{ $json.clean_domain }}",
        "options": {}
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        704,
        1520
      ],
      "id": "240aeef1-6e91-4764-98f2-4f6b30682628",
      "name": "Check If Company Already Exists",
      "alwaysOutputData": true,
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "12a8fb03-978f-4afc-a582-d0234a9326c8",
              "leftValue": "={{ $('Check If Lead Already Exists in HubSpot') }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        416,
        1936
      ],
      "id": "82f7c6c8-9a2b-445f-85b9-b7549fe29fe9",
      "name": "Contact Does Not Exist in HubSpot?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.brightdata.com/datasets/v3/trigger",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "dataset_id",
              "value": "gd_l1viktl72bvl7bjuj0"
            },
            {
              "name": "notify",
              "value": "false"
            },
            {
              "name": "include_errors",
              "value": "true"
            },
            {
              "name": "include_errors",
              "value": "true"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 5788c4c3e3897a701af663fdc5b08755d8123e6f207fd0ea00a995822ada81ef"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"input\": [\n    {\n      \"url\": \"{{$('Webhook: Contact Form New Submission').first().json.body[\"Your LinkedIn URL\"]}}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        720,
        1936
      ],
      "id": "96977f65-0f38-44e2-abe3-73a2ec83a4f4",
      "name": "Scrape Lead's LinkedIn with BrightData",
      "retryOnFail": true,
      "notesInFlow": true,
      "onError": "continueErrorOutput",
      "notes": "HTTP POST Request"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e462f931-8b61-4903-b63e-ccd5a3e111ab",
              "leftValue": "={{ $json.status }}",
              "rightValue": "ready",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1328,
        1936
      ],
      "id": "221ce907-81eb-4d47-aaa6-4cfd36757554",
      "name": "If Status == Ready"
    },
    {
      "parameters": {
        "url": "=https://api.brightdata.com/datasets/v3/snapshot/{{ $json.snapshot_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "brightdataApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {}
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1552,
        1936
      ],
      "id": "eda9cc90-2b2d-45f6-9ed2-123702d78bc9",
      "name": "Get Lead's LinkedIn Results",
      "retryOnFail": true,
      "credentials": {
        "brightdataApi": {
          "id": "sOLFyFTfSuuEKeyz",
          "name": "fortuna.develops Google Sign In"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.brightdata.com/datasets/v3/progress/{{ $('Scrape Lead\\'s LinkedIn with BrightData').first().json.snapshot_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 5788c4c3e3897a701af663fdc5b08755d8123e6f207fd0ea00a995822ada81ef"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1120,
        1936
      ],
      "id": "0871137d-56e3-4c4e-86fe-4e75000fbcca",
      "name": "Check Scraping Process Status",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "//Clean up company domain entered in the \"Contact Us\" form\nconst companyDomain = $input.first()?.json?.body[\"Your Company Website\"] || \"\";\nconst regexURLPattern = /^(?:https?:\\/\\/)?(?:www\\.)?([a-zA-Z0-9-]+\\.[a-zA-Z]{2,})(?:[\\/\\?#].*)?$/;\n\nconst matchResult = companyDomain.match(regexURLPattern);\n\nif (matchResult) {\n  return {\n    \"clean_domain\": matchResult[1]\n  }\n} else { //This block executes ONLY if no match is found\n  return {\n    \"clean_domain\": \"Not Found\"\n  }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        1376
      ],
      "id": "5b2a9f58-04c6-46b2-8537-fe8c39a02c0f",
      "name": "Extract Company Domain",
      "notesInFlow": true,
      "notes": "JavaScript Code Node"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09MZJHFA05",
          "mode": "list",
          "cachedResultName": "n8n-errors"
        },
        "text": "=---------------- *ERROR WITH N8N WORKFLOW: {{ $workflow.name }}* ----------------\n*Workflow ID:* {{ $workflow.id }}\n*Execution ID:* {{ $execution.id }}\n*Error Timestamp:* {{ $now.toLocal().format('yyyy-MM-dd hh:mm:ss') }}\n*Node(s):* _Validate Company Domain_\n*Error Message:* clean_domain = {{ $json.clean_domain }}. The company domain entered by lead {{ $('Webhook: Contact Form New Submission').item.json.body['First Name'] + \" \" + $('Webhook: Contact Form New Submission').item.json.body['Last Name'] + \" with email \" + $('Webhook: Contact Form New Submission').item.json.body['Work Email'] }} failed the validation check.",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        448,
        1536
      ],
      "id": "927a40ed-1458-4279-8821-b6fea43ae6e6",
      "name": "Error: Validating Company Domain",
      "webhookId": "d1b0ffc5-302f-4998-9d69-bd42079a79cc",
      "credentials": {
        "slackApi": {
          "id": "mkWLWUFV2SEuHOTp",
          "name": "n8n Slack - 3/11/2025"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "22b40b2b-33a3-4ac8-98cc-b2bf6283fed8",
              "leftValue": "={{ $json.clean_domain }}",
              "rightValue": "Not Found",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        448,
        1376
      ],
      "id": "63cfece1-7e61-448f-b2ec-4b5157c7a44b",
      "name": "Valid Company Domain?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2bde478a-e1c9-4a61-be79-1aa283a1b8c5",
              "leftValue": "={{ $('Check If Company Already Exists') }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": true
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        912,
        1520
      ],
      "id": "7c64873e-108a-4aaf-89da-a1b7d7272747",
      "name": "Company Does Not Exist in HubSpot?",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.brightdata.com/datasets/v3/trigger",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "dataset_id",
              "value": "gd_l1vijqt9jfj7olije"
            },
            {
              "name": "notify",
              "value": "false"
            },
            {
              "name": "include_errors",
              "value": "true"
            },
            {
              "name": "type",
              "value": "discover_new"
            },
            {
              "name": "discover_by",
              "value": "keyword"
            },
            {
              "name": "limit_per_input",
              "value": "1"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 5788c4c3e3897a701af663fdc5b08755d8123e6f207fd0ea00a995822ada81ef"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"input\": [\n    {\n      \"keyword\": \"{{ $('Webhook: Contact Form New Submission').item.json.body['Your Company Website'] }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1200,
        1520
      ],
      "id": "a3b9c7ac-f2c4-41fa-89aa-33ac4faa3968",
      "name": "Enrich Company with Crunchbase",
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://api.brightdata.com/datasets/v3/progress/{{ $('Enrich Company with Crunchbase').item.json.snapshot_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 5788c4c3e3897a701af663fdc5b08755d8123e6f207fd0ea00a995822ada81ef"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1632,
        1520
      ],
      "id": "6f693f22-4032-402c-9cdc-11168e2f9108",
      "name": "Check Crunchbase Enrichment Status",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://api.brightdata.com/datasets/v3/snapshot/{{ $('Enrich Company with Crunchbase').item.json.snapshot_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 5788c4c3e3897a701af663fdc5b08755d8123e6f207fd0ea00a995822ada81ef"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2112,
        1520
      ],
      "id": "5f6de811-e0c0-4feb-8ee3-6332e087caaa",
      "name": "Get Company Enrichment Data",
      "retryOnFail": true,
      "alwaysOutputData": false,
      "notesInFlow": false,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "authentication": "appToken",
        "resource": "company",
        "name": "={{ $json.companyName }}",
        "additionalFields": {
          "aboutUs": "={{ $json.about }}",
          "companyDomainName": "={{ $json.companyDomain }}",
          "countryRegion": "={{ $json.country }}",
          "customPropertiesUi": {
            "customPropertiesValues": [
              {
                "property": "tier",
                "value": "={{ $json.industry }}"
              },
              {
                "property": "location",
                "value": "={{ $json.companyType }}"
              },
              {
                "property": "company_id",
                "value": "={{ $json.numberOfEmployees }}"
              }
            ]
          },
          "description": "={{ $json.description }}",
          "linkedinBio": "={{ $json.builtWithTech }}",
          "streetAddress": "={{ $json.productsAndServices }}"
        }
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        2624,
        1632
      ],
      "id": "21897c32-bc81-464d-9cf6-40eb5285c5a8",
      "name": "Create Company on HubSpot",
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "//Score each lead (0-100 points) depending on location (15 points), job role (20 points) and seniority (10 points), product interest (30 points), urgency (10 points), pain points (10 points) and engagement quality (5 points)\n\n//Extract answers from \"Contact Us\" form or defaults to an empty string\nconst productInterest = $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Which product area are you most interested in? \"] || \"\";\nconst challengeText = $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Tell us about your primary challenge or goal:\"].toLowerCase() || \"\";\n\n//Extract data from LinkedIn scraping results or defaults to an empty string/array\nconst jobTitle = String($input.first()?.json?.current_company?.title).toLowerCase() || \"\";\nconst yearsExperienceText = String($input.first()?.json?.experience?.[0]?.duration).toLowerCase() || \"\";\nconst countryCode = String($input.first()?.json?.country_code).toLowerCase() || \"\";\nconst linkedinActivityData = $input.first()?.json?.activity;\n\n//Extract activity data from LinkedIn and store in array\nconst latestLinkedinActivity = (Array.isArray(linkedinActivityData) ? linkedinActivityData : [])\n  .map(activity => {\n    return {\n      interaction: activity?.interaction || \"\",\n      postTitle: activity?.title || \"\",\n      postLink: activity?.link || \"\"\n    };\n  });\n\n//Initialize score counters\nlet leadScore = 0;\nlet locationScore = 0;\nlet jobRoleScore = 0;\nlet experienceScore = 0;\nlet productScore = 0;\nlet challengeScore = 0;\nlet urgencyFlag = false;\nlet painPointsFlag = false;\nlet detailedDescriptionFlag = false;\n\n//To store the reasoning for each score criteria\nconst scoreReasons = [];\n\n//Convert years of experience text to total months\nlet totalMonths = 0;\nlet years = 0;\nlet months = 0;\n\n//Look for numbers before \"year\"\nconst yearIndex = yearsExperienceText.indexOf(\"year\");\nif (yearIndex > 0) {\n  //Look backwards for the number before \"year\"\n  const yearPart = yearsExperienceText.substring(0, yearIndex).trim();\n  //Extract the last number before \"year\"\n  let digits = \"\";\n  for (let i = yearPart.length - 1; i >= 0; i--) {\n    const char = yearPart[i];\n    if (/\\d/.test(char)) {\n      digits = char + digits;\n    } else if (digits) {\n    //Stop when it hits a non-digit after finding digits\n      break;\n    }\n  }\n  if (digits) {\n    years = parseInt(digits, 10);\n  }\n}\n\n//Look for numbers before \"month\"\nconst monthIndex = yearsExperienceText.indexOf(\"month\");\nif (monthIndex > 0) {\n  //Look backwards for the number before \"month\"\n  const monthPart = yearsExperienceText.substring(0, monthIndex).trim();\n  //Extract the last number before \"month\"\n  let digits = \"\";\n  for (let i = monthPart.length - 1; i >= 0; i--) {\n    const char = monthPart[i];\n    if (/\\d/.test(char)) {\n      digits = char + digits;\n    } else if (digits) {\n    //Stop when it hits a non-digit after finding digits\n      break;\n    }\n  }\n  if (digits) {\n    months = parseInt(digits, 10);\n  }\n}\n\ntotalMonths = (years * 12) + months;\n\n//Location Scoring (15 points max)\nif (countryCode === \"us\") {\n  leadScore += 15;\n  scoreReasons.push(\"United States location\");\n} \n//Other English-speaking countries\nelse if ([\"ca\", \"gb\", \"au\", \"nz\"].includes(countryCode)) {\n  leadScore += 10;\n  scoreReasons.push(`${countryCode.toUpperCase()} location (English-speaking)`);\n}\n//Any other specified country\nelse if (countryCode) {\n  leadScore += 5;\n  scoreReasons.push(\"International location\");\n}\n\nlocationScore = leadScore;\n\n//Job Role & Seniority (30 points max)\n//Job Role (20 points)\nconst executiveTerms = [\"ceo\", \"chief\", \"president\", \"founder\"];\nconst financeExecTerms = [\"cfo\", \"vp finance\", \"finance director\"];\nconst directorTerms = [\"vp\", \"director\", \"head of\"];\nconst managerTerms = [\"manager\", \"controller\", \"accountant\"];\n\nif (executiveTerms.some(term => jobTitle.includes(term))) {\n  leadScore += 20;\n  scoreReasons.push(\"C-Level/Founder\");\n} else if (financeExecTerms.some(term => jobTitle.includes(term))) {\n  leadScore += 20;\n  scoreReasons.push(\"Finance Executive\");\n} else if (directorTerms.some(term => jobTitle.includes(term))) {\n  leadScore += 15;\n  scoreReasons.push(\"VP/Director level\");\n} else if (managerTerms.some(term => jobTitle.includes(term))) {\n  leadScore += 10;\n  scoreReasons.push(\"Finance Manager\");\n} else if (jobTitle && jobTitle !== \"\") {\n  leadScore += 5;\n  scoreReasons.push(\"Has job title specified\");\n}\n\njobRoleScore = leadScore - locationScore;\n\n//Seniority (10 points)\nif (totalMonths >= 120) {//10+ years\n  leadScore += 10;\n  scoreReasons.push(\"10+ years experience\");\n} else if (totalMonths >= 60) {//5-10 years\n  leadScore += 7;\n  scoreReasons.push(\"5-10 years experience\");\n} else if (totalMonths >= 24) {//2-5 years\n  leadScore += 5;\n  scoreReasons.push(\"2-5 years experience\");\n}\n\nexperienceScore = leadScore - locationScore - jobRoleScore;\n\n//Product Interest Scoring (30 points max)\nconst productScores = {\n  \"Bank Data Consolidation & Feeds\": 25,\n  \"Cash Flow Monitoring & Analytics\": 20,\n  \"Revenue Forecasting & Modeling\": 20,\n  \"Automated Financial Workflows\": 15,\n  \"ERP/Accounting Software Integrations (e.g., NetSuite, QuickBooks)\": 15,\n  \"I\\m not sure yet, please advise\": 5\n};\n\nif (productInterest in productScores) {\n  leadScore += productScores[productInterest];\n  scoreReasons.push(`Interest: ${productInterest}`);\n}\n\nproductScore = leadScore - locationScore - jobRoleScore - experienceScore;\n\n//Challenge Text Analysis (25 points max)\nif (challengeText) {\n  //Urgency signals (10 points)\n  const urgencyTerms = [\"urgent\", \"asap\", \"immediately\", \"critical\", \"pressing\"];\n  if (urgencyTerms.some(term => challengeText.includes(term))) {\n    leadScore += 10;\n    scoreReasons.push(\"Urgent need expressed\");\n    urgencyFlag = true;\n  }\n\n  //Specific pain points (10 points)\n  const pain_points = [\"consolidate\", \"multiple bank\", \"cash flow\", \"forecast\", \"manual process\", \"automate\", \"integrat\", \"real-time\", \"reporting\", \"efficiency\"];\n  if (pain_points.some(pain => challengeText.includes(pain))) {\n    leadScore += 10;\n    scoreReasons.push(\"Specific pain points mentioned\");\n    painPointsFlag = true;\n  }\n\n  //Length bonus (5 points)\n  if (challengeText.length > 50) {\n    leadScore += 5;\n    scoreReasons.push(\"Detailed challenge description\");\n    detailedDescriptionFlag = true;\n  }\n}\n\n//Determine Contact Tier\nlet contactTier;\nif (leadScore >= 70) {\n  contactTier = \"DECISION_MAKER\";\n  scoreReasons.push(\"Senior role with specific financial automation needs\");\n} else if (leadScore >= 50) {\n  contactTier = \"HIGH_VALUE\";\n  scoreReasons.push(\"Strong interest in core financial services with clear pain points\");\n} else if (leadScore >= 30) {\n  contactTier = \"WARM_LEAD\";\n  scoreReasons.push(\"Moderate interest with some specific needs\");\n} else if (leadScore >= 15) {\n  contactTier = \"COLD_LEAD\";\n  scoreReasons.push(\"General interest but limited specifics\");\n} else {\n  contactTier = \"UNQUALIFIED\";\n  scoreReasons.push(\"Insufficient information or interest\");\n}\n\nreturn {\n  //Extract data from form submission\n  \"firstName\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"First Name\"] || \"\",\n  \"lastName\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Last Name\"] || \"\",\n  \"phoneNumber\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Phone Number\"] || \"\",\n  \"linkedinURL\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Your LinkedIn URL\"] || \"\",\n  \"workEmail\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Work Email\"] || \"\",\n  \"companyWebsite\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Your Company Website\"] || \"\",\n  \"productInterest\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Which product area are you most interested in? \"] || \"\",\n  \"challengeText\": $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Tell us about your primary challenge or goal:\"] || \"\",\n  //Extract data from LinkedIn scraping results\n  \"currentCompany\": $input.first()?.json?.current_company?.name || \"\",\n  \"jobTitle\": String($input.first()?.json?.current_company?.title),\n  \"totalYearsAtCompany\": (totalMonths / 12).toFixed(2),\n  \"countryCode\": countryCode,\n  \"city\": $input.first()?.json?.city || \"\",\n  \"about\": $input.first()?.json?.about || \"\",\n  \"latestCertification\": ($input.first()?.json?.certifications?.subtitle) ? $input.first()?.json?.certifications[0]?.subtitle : \"\",\n  \"educationDetails\": $input.first()?.json?.educations_details || \"\",\n  \"latestLinkedinActivity\": JSON.stringify(latestLinkedinActivity),\n  //Display lead-scoring data\n  \"totalLeadScore\": leadScore,\n  \"contactTier\": contactTier,\n  \"locationScore\": locationScore,\n  \"jobRoleScore\": jobRoleScore,\n  \"experienceScore\": experienceScore,\n  \"productScore\": productScore,\n  \"challengeScore\": challengeScore,\n  \"urgencyFlag\": urgencyFlag,\n  \"painPointsFlag\": painPointsFlag,\n  \"detailedDescriptionFlag\": detailedDescriptionFlag,\n  \"scoreReasons\": String(scoreReasons),\n  \"leadEnrichedTimestamp\": $input.first()?.json?.timestamp || \"\"\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1840,
        1936
      ],
      "id": "697d973b-6a5d-4aa1-a799-d1eefa1409b3",
      "name": "Aggregate & Give Lead a Score (0-100)",
      "notesInFlow": true,
      "notes": "JavaScript Code Node"
    },
    {
      "parameters": {
        "jsCode": "//Extract data from arrays\nconst industryRaw = $input.first()?.json?.industries;\nconst industry = (Array.isArray(industryRaw) ? industryRaw : [])\n  .map(industry => {\n    return industry?.value || \"\";\n  });\n\nconst builtWithTechRaw = $input.first()?.json?.builtwith_tech;\nconst builtWithTech = (Array.isArray(builtWithTechRaw) ? builtWithTechRaw : [])\n  .map(tech => {\n    return {\n      techName: tech?.name || \"\",\n      techCategory: tech?.technology_category?.[0] || \"\"\n    };\n  });\n\nconst productsAndServicesRaw = $input.first()?.json?.products_and_services;\nconst productsAndServices = (Array.isArray(productsAndServicesRaw) ? productsAndServicesRaw : []) \n  .map(product => {\n    return {\n      \"productName\": product?.product_name || \"\",\n      \"productDescription\": product?.product_description || \"\"\n    };\n  });\n\nreturn {\n  //Extract data from previous node for the clean domain URL\n  \"companyDomain\": $('Extract Company Domain').first()?.json?.clean_domain || \"\",\n  //Extract enriched data from Crunchbase\n  \"companyName\": $input.first()?.json?.name || \"\",\n  \"about\": $input.first()?.json?.about || \"\",\n  \"description\": $input.first()?.json?.full_description || \"\",\n  \"industry\": String(industry),\n  \"companyType\": $input.first()?.json?.company_type || \"\",\n  \"numberOfEmployees\": $input.first()?.json?.num_employees || \"\",\n  \"country\": $input.first()?.json?.country_code || \"\",\n  \"email\": $input.first()?.json?.contact_email || \"\",\n  \"phone\": $input.first()?.json?.contact_phone || \"\",\n  \"builtWithTech\": JSON.stringify(builtWithTech) || \"\",\n  \"ipoStatus\": $input.first()?.json?.ipo_status || \"\",\n  \"monthlyVisits\": $input.first()?.json?.monthly_visits || \"\",\n  \"productsAndServices\": JSON.stringify(productsAndServices),\n  \"companyEnrichedTimestamp\": $input.first()?.json?.timestamp || \"\"  \n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2400,
        1632
      ],
      "id": "5b772481-f9a6-4402-8eea-0b3d0fad983e",
      "name": "Aggregate Enriched Company Data"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "workspace": "1211855858465103",
        "name": "=Assign New Lead in HubSpot: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.firstName + $('Aggregate & Give Lead a Score (0-100)').item.json.lastName + \" (\" + $('Aggregate & Give Lead a Score (0-100)').item.json.workEmail + \")\"}}",
        "otherProperties": {
          "due_on": "={{(()=>{\nlet dueDate = new Date();\ndueDate.setDate(dueDate.getDate() + 2)\nwhile (dueDate.getDay() == 0 || dueDate.getDay() == 6) {\ndueDate.setDate(dueDate.getDate() + 1)\n}\nreturn dueDate;\n})()}}",
          "notes": "=HubSpot Contact Link: https://app-na2.hubspot.com/contacts/{{ $json['portal-id'] }}/record/0-1/{{ $json.vid }}\nCompany: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.currentCompany }}\nJob Title: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.jobTitle }}\nProduct Interest: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.productInterest }}\nChallenge Mentioned: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.challengeText }}\nPhone Number: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.phoneNumber }}\nLinkedIn: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.linkedinURL }}",
          "projects": [
            "1211855916092347"
          ]
        }
      },
      "type": "n8n-nodes-base.asana",
      "typeVersion": 1,
      "position": [
        2400,
        1936
      ],
      "id": "3398693c-e8b1-43ee-b115-e819d50cdb4a",
      "name": "Create Task For Sales Team",
      "credentials": {
        "asanaOAuth2Api": {
          "id": "JEmf5ZvKHjj5lJVE",
          "name": "fortuna.develops - Asana 5/11/2025"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "hubspot",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -64,
        3296
      ],
      "id": "0f80d3a3-7e6b-40e1-9a21-df8a3d34eeed",
      "name": "HubSpot Trigger: CSR Assigned to Contact",
      "webhookId": "829778df-ed45-49ab-908c-ef34c008140d"
    },
    {
      "parameters": {
        "url": "=https://api.hubapi.com/settings/v3/users/84292262",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "hubspotAppToken",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        400,
        3296
      ],
      "id": "78e0ad6c-c0a6-47d1-93a2-779faff16bb3",
      "name": "Get CSR from HubSpot",
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "697cd098-7482-406f-aa93-39a0c093b2c6",
              "leftValue": "={{ $json.body[0].propertyValue }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        3296
      ],
      "id": "403c7a1e-d3ad-40c9-9eee-90ee33d0a17b",
      "name": "Contact Owner Assigned?"
    },
    {
      "parameters": {
        "authentication": "appToken",
        "operation": "get",
        "contactId": {
          "__rl": true,
          "value": "={{ $('HubSpot Trigger: CSR Assigned to Contact').item.json.body[0].objectId }}",
          "mode": "id"
        },
        "additionalFields": {
          "propertiesCollection": {
            "propertiesValues": {
              "properties": [
                "contact_id",
                "work_email",
                "city",
                "company",
                "company_size",
                "lead_score",
                "company_id",
                "utm_campaign",
                "degree",
                "firstname",
                "lastname",
                "jobtitle",
                "phone",
                "school",
                "seniority",
                "marital_status"
              ],
              "propertyMode": "valueOnly"
            }
          }
        }
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        608,
        3296
      ],
      "id": "ac74d82f-a9d0-4be1-acfe-b640db1fa32e",
      "name": "Get Lead from HubSpot",
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "28c8fcea-4f32-4ab5-b542-2171c41ae5c4",
              "name": "lead_first_name",
              "value": "={{ $json.properties.firstname.value }}",
              "type": "string"
            },
            {
              "id": "acda95f4-6d5b-4f20-ac58-81a8dfa50a6c",
              "name": "lead_last_name",
              "value": "={{ $json.properties.lastname.value }}",
              "type": "string"
            },
            {
              "id": "c968ddde-3108-4ffb-8233-eccf64df6d30",
              "name": "lead_city",
              "value": "={{ $json.properties.city.value }}",
              "type": "string"
            },
            {
              "id": "df755238-1379-41d4-9b0b-035632c5cb88",
              "name": "lead_about",
              "value": "={{ $json.properties.contact_id.value }}",
              "type": "string"
            },
            {
              "id": "f16257a6-6d28-4225-aedf-cb2667926aaa",
              "name": "lead_job_title",
              "value": "={{ $json.properties.jobtitle.value }}",
              "type": "string"
            },
            {
              "id": "e61f8f7c-4a3e-44fa-b44c-9a669cc3b8d2",
              "name": "lead_years_at_company",
              "value": "={{ $json.properties.seniority.value + \" years\"}}",
              "type": "string"
            },
            {
              "id": "b7b20dfc-106b-4bb7-ba62-7a57d6843d08",
              "name": "lead_company_name",
              "value": "={{ $json.properties.company.value }}",
              "type": "string"
            },
            {
              "id": "ffced166-d4fd-4bd5-8044-c7670dd4b0e2",
              "name": "lead_interested_in_product",
              "value": "={{ $json.properties.company_id.value }}",
              "type": "string"
            },
            {
              "id": "77e17a6a-415a-4f82-a65e-efcc4b0740b7",
              "name": "lead_goal_or_challenge",
              "value": "={{ $json.properties.marital_status.value }}",
              "type": "string"
            },
            {
              "id": "769f124d-da5e-4856-aff1-54557d157b4a",
              "name": "lead_score",
              "value": "={{ $json.properties.lead_score.value }}",
              "type": "string"
            },
            {
              "id": "e6ad5eef-38be-4f52-8e63-46b14e4c7127",
              "name": "lead_score_reasons",
              "value": "={{ $json.properties.company_size.value }}",
              "type": "string"
            },
            {
              "id": "c49d0c02-9546-42b2-afd8-c2f857a6efe6",
              "name": "lead_latest_linkedin_activity",
              "value": "={{ $json.properties.utm_campaign.value.parseJson() }}",
              "type": "string"
            },
            {
              "id": "b7d61786-99af-4d6f-8763-bb50480f67a1",
              "name": "company_description",
              "value": "={{ $json['associated-company'].properties.description.value }}",
              "type": "string"
            },
            {
              "id": "1be3cd1f-7679-4729-a7cd-9c673406ca82",
              "name": "company_industry",
              "value": "={{ $json['associated-company'].properties.tier.value }}",
              "type": "string"
            },
            {
              "id": "f3112a08-1e67-49cb-8cdd-207e750ba0f0",
              "name": "company_products_and_services",
              "value": "={{ $json['associated-company'].properties.address.value }}",
              "type": "string"
            },
            {
              "id": "811b1843-d9a1-4d2f-a4e9-b446f84e29a8",
              "name": "company_size",
              "value": "={{ $json['associated-company'].properties.company_id.value + \" employees\"}}",
              "type": "string"
            },
            {
              "id": "c6905e2a-5c86-470f-911c-371f2e4debba",
              "name": "lead_work_email",
              "value": "={{ $json.properties.work_email.value }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1088,
        2992
      ],
      "id": "4a48abb9-0cee-42d4-b45f-779f9a36c65a",
      "name": "Aggregate Lead and Company Enriched Data"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "lead_and_company_data",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1296,
        2992
      ],
      "id": "dc288920-4f71-4f00-995d-7042223d111f",
      "name": "Aggregate All Data in One Field"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Lead and company information: {{ $('Aggregate All Data in One Field').item.json.lead_and_company_data.toJsonString() }}",
        "options": {
          "systemMessage": "# Role\nYou are an expert sales agent part of Central Money, a B2B SaaS company. Central Money gives finance leaders real-time financial foresight by unifying all financial systems into a single, predictive platform. \n\n# Context\nThe Customer Success Rep is about to schedule a first call with the new lead. \n\n# Task\nTaking the information you know about the lead and their company, craft a very personalized, brief welcome email in a casual tone. Focus on being personal to the lead, but also specifically pointing out the business value of the product for the lead's specific company.\n\n# Rules\n- Do not include a signature, just output the body of the text. Do not include \"Cheers,\" or \"Best,\". Just the salutation and the first part of the email body.\n- Act as if the CSR wrote the message.\n- Output the body of the text in HTML format. Do not include the three backticks at the beginning or end of your output.\n- Your output should ONLY contain HTML.\n- Include links to the LinkedIn posts you mention. Do not make up any links or information."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1520,
        2928
      ],
      "id": "a1cf5656-3ee8-4279-b2aa-63b775131d87",
      "name": "AI Email Crafter"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1504,
        3104
      ],
      "id": "e6510857-67ad-42a6-9e81-2ebb1c07ea06",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "elZF5yzc5s4XT1j5",
          "name": "ingridjonec Google Gemini AI Studio"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $('Get CSR from HubSpot').first().json.email }}",
        "subject": "=ACTION REQUIRED: Send 1st Email To New Lead {{ $('Aggregate Lead and Company Enriched Data').first().json.lead_first_name + \" \" + $('Aggregate Lead and Company Enriched Data').first().json.lead_last_name }}",
        "message": "=<!DOCTYPE html>\n<html>\n<head>\n<title>ACTION REQUIRED: Send 1st Email To New Lead {{ $('Aggregate Lead and Company Enriched Data').first().json.lead_first_name + \" \" + $('Aggregate Lead and Company Enriched Data').first().json.lead_last_name }}</title>\n<style>\n\n</style>\n</head>\n<body>\n<p><em>Hi {{ $('Get CSR from HubSpot').first().json.firstName }}, I saw you are the new contact owner for {{ $('Aggregate Lead and Company Enriched Data').first().json.lead_first_name + \" \" + $('Aggregate Lead and Company Enriched Data').first().json.lead_last_name }} in HubSpot: https://app-na2.hubspot.com/contacts/244173490/record/0-1/{{ $('Get Lead from HubSpot').first().json.vid }} </em></p>\n\n<h2>Here's an email draft to send to the new lead. Ensure you proofread and edit it, if needed, before you send it to the lead's email {{ $('Aggregate Lead and Company Enriched Data').first().json.lead_work_email }}:</h2>\n<h3>Subject: Welcome to Central Money, {{ $('Aggregate Lead and Company Enriched Data').first().json.lead_first_name.replace(\" \", \"\") }}!<h3>\n<h3>Email Body:</h3>\n<p>\n{{ $('AI Email Crafter').first().json.output }}\n</p>\n{{ $('Initialize Available Meeting Time (9-5)').first().json.availableSlots }} \nIf these times do not work, schedule a time with me here: calendly.com/{{ $('Get CSR from HubSpot').first().json.firstName.toLowerCase() }}\n<br>\n<br>\n{{ $('Get CSR from HubSpot').first().json.firstName }} from Central Money\n<br>\n{{ $('Get CSR from HubSpot').first().json.email }}\n</body>\n</html>\n",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2384,
        2992
      ],
      "id": "d9475ae3-ef32-48d7-80db-f82fca1d895b",
      "name": "Send Draft Email to CSR",
      "webhookId": "0203644f-e39c-49a6-a287-e37c37e83679",
      "credentials": {
        "gmailOAuth2": {
          "id": "ILwFji1Jn2nIUfjZ",
          "name": "fortuna.develops - Gmail 4/11/2025"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Clean up busyTimes from CSR's calendar\nconst busyTimes = [];\nfor (const item of $input.all()) {\n  let start = DateTime.fromISO(item.json.start.dateTime);\n  let end = DateTime.fromISO(item.json.end.dateTime);\n  let timezone = item.json.start.timeZone;\n  busyTimes.push({\n    start: start,\n    end: end,\n    timezone: timezone,\n  });\n}\n\n// Function to round the time to the nearest 30-minute or 60-minute interval\nfunction roundUpToNearestIntervalLocal(date) {\n  const minutes = date.minute;\n  const next30 = minutes + (30 - (minutes % 30));\n  const next60 = minutes + (60 - (minutes % 60));\n\n  const diff30 = Math.abs(next30 - minutes);\n  const diff60 = Math.abs(next60 - minutes);\n\n  const rounded = diff30 < diff60 ? next30 : next60;\n\n  return date.set({ minute: rounded, second: 0, millisecond: 0 });\n}\n\n// Ensure at least 1 hour gap between now and the start time\nfunction ensureMinimumGap(date) {\n  const now = DateTime.local();\n  const minGap = 60; // Minimum gap in minutes (1 hour)\n\n  if (date.diff(now, 'minutes').minutes < minGap) {\n    date = date.plus({ minutes: minGap });\n  }\n\n  return date;\n}\n\n// Clamp the time to business hours (9amâ€“5pm) and exclude weekends\nfunction clampToBusinessHours(date) {\n  const dayOfWeek = date.weekday; // 1 = Monday, 7 = Sunday\n\n  if (dayOfWeek === 6) { // Saturday\n    date = date.plus({ days: 2 }).set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n  } else if (dayOfWeek === 7) { // Sunday\n    date = date.plus({ days: 1 }).set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n  } else if (date.hour < 9) { // Before 9 AM\n    date = date.set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n  } else if (date.hour >= 17) { // After 5 PM\n    date = date.plus({ days: 1 }).set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n  }\n\n  return date;\n}\n\n// Add 1 hour to the meeting time\nfunction addOneHour(date) {\n  return date.plus({ hours: 1 });\n}\n\n// Find the next available time slot excluding busy times\nfunction findNextAvailableSlot(busyTimes, startTime) {\n  let currentTime = startTime;\n\n  // Sort the busy times by start time\n  busyTimes.sort((a, b) => a.start - b.start);\n\n  // Iterate through busy times and check for available gaps\n  for (let i = 0; i < busyTimes.length; i++) {\n    const busyStart = busyTimes[i].start;\n    const busyEnd = busyTimes[i].end;\n\n    // If the current time is before a busy time and there is a gap\n    if (currentTime < busyStart) {\n      const gap = busyStart.diff(currentTime, 'minutes').minutes;\n\n      // If the gap is larger than 60 minutes, we found an available slot\n      if (gap >= 60) {\n        const slotStart = currentTime;\n        const slotEnd = slotStart.plus({ minutes: 60 });\n\n        return { start: slotStart, end: slotEnd };\n      }\n    }\n\n    // If the current time is after a busy period, move past it\n    if (currentTime < busyEnd) {\n      currentTime = busyEnd;\n    }\n  }\n\n  // If there are no gaps, return null\n  return null;\n}\n\n// Main logic to get 3 available meeting time slots\nfunction getNextAvailableSlots(busyTimes) {\n  const availableSlots = [];\n  let currentDate = DateTime.local();\n\n  // Loop to find the next 3 available slots over the next few days\n  while (availableSlots.length < 3) {\n    let roundedLocal = roundUpToNearestIntervalLocal(currentDate);\n    let minimumGapTime = ensureMinimumGap(roundedLocal);\n    let clampedTime = clampToBusinessHours(minimumGapTime);\n\n    // Find the next available slot on this day\n    const availableSlot = findNextAvailableSlot(busyTimes, clampedTime);\n\n    // If a slot is found, add it to the available slots list\n    if (availableSlot) {\n      // Add 1 hour to the start time\n      const plusOneHour = addOneHour(availableSlot.start);\n      availableSlots.push({\n        startTime: availableSlot.start.toISO(),\n        endTime: plusOneHour.toISO(),\n      });\n\n      // Move to the next day after the found slot\n      currentDate = availableSlot.end.plus({ days: 1 }).set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n    } else {\n      // If no available slot was found, move to the next day\n      currentDate = currentDate.plus({ days: 1 }).set({ hour: 9, minute: 0, second: 0, millisecond: 0 });\n    }\n\n    // If there are no gaps in the next 2 weeks, break\n    if (currentDate.diff(DateTime.local().plus({ weeks: 2 }), 'days').days >= 0) {\n      break;\n    }\n  }\n\n  return availableSlots.length ? availableSlots : [{ startTime: \"None found\", endTime: \"None found\" }];\n}\n\n// Get the next 3 available slots\nconst nextAvailableSlots = getNextAvailableSlots(busyTimes);\n\n// Format the available slots into a readable email-friendly format\nfunction formatSlotsForEmail(slots) {\n  if (slots[0].startTime === \"None found\") {\n    return \"Unfortunately, no available slots were found in the next two weeks.\";\n  }\n\n  let emailBody = \"Here are my next available meeting times:<br>\";\n\n  slots.forEach((slot) => {\n    emailBody += `Start: ${DateTime.fromISO(slot.startTime).toLocaleString(DateTime.DATETIME_MED)}<br>`;\n    emailBody += `End: ${DateTime.fromISO(slot.endTime).toLocaleString(DateTime.DATETIME_MED)}<br><br>`;\n  });\n\n  return emailBody;\n}\n\n// Generate the email body\nconst emailBody = formatSlotsForEmail(nextAvailableSlots);\n\n// Output the formatted email body\nconsole.log(emailBody);\n\nreturn {\"availableSlots\": emailBody};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        2992
      ],
      "id": "dad6c90b-0db8-4dc1-bcd1-58e4308b81fe",
      "name": "Initialize Available Meeting Time (9-5)"
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "={{ $('Get CSR from HubSpot').item.json.email }}",
          "mode": "id"
        },
        "returnAll": true,
        "timeMax": "={{ $now.plus({ week: 2 }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        1904,
        2992
      ],
      "id": "d87bd5fa-dbc7-41c6-a0e3-f9803e7f03f6",
      "name": "Check CSR's Next 2 Weeks",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "7OM6W8z1r5IQQV7n",
          "name": "fortuna.develops n8n Google"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "3ab6bc3b-ae05-4130-bee7-fda302d8c466",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -64,
        1424
      ],
      "id": "6f9e6ce4-bf45-44d4-a216-f10ad3e701ba",
      "name": "Webhook: Contact Form New Submission",
      "webhookId": "3ab6bc3b-ae05-4130-bee7-fda302d8c466"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1456,
        1520
      ],
      "id": "9965f230-e41f-4c4c-acb2-b8ec6f6b9f6a",
      "name": "Wait 30 Seconds",
      "webhookId": "a15a826c-de98-47fa-81e9-b5b24f7d6f8f"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        944,
        1936
      ],
      "id": "403f2cae-eda1-4a82-869e-c3ef6d73b47a",
      "name": "Wait 30 Secs",
      "webhookId": "a15a826c-de98-47fa-81e9-b5b24f7d6f8f"
    },
    {
      "parameters": {
        "content": "## 0. TRIGGER: Lead Submits \"Contact Us\" Form (Google Forms)\n- The webhook is triggered when a new lead fills out and submits a \"Contact Us\" form.\n- The webhook is configured through the [Google Apps Script service](https://developers.google.com/apps-script/reference), which allowed me to send each new form submission to this n8n webhook trigger. Learn more about how to implement this [here](https://medium.com/@eyalgershon/sending-a-webhook-for-each-google-forms-submission-a0e73f72b397)!",
        "height": 592,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -160,
        1056
      ],
      "typeVersion": 1,
      "id": "8d82aeb3-fb49-4bd7-a915-e5a7dbce0535",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## PHASE 1: Enrich Company Data with Crunchbase and Add Company to HubSpot",
        "height": 1056,
        "width": 3072,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -176,
        768
      ],
      "typeVersion": 1,
      "id": "1bac6a3c-67cc-498d-8339-805b3d6d656b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## 1. Clean Company Domain\n**Purpose**: Extracts and standardizes the clean and valid company domain from the form submission, since the following company enrichment steps need the company's URL. It also ensures all company domains follow the same pattern in the CRM, for easy filtering and reporting.\n\n*Input*: The raw string from the form field named \"Your Company Website\".\n\nTakes the user-entered value and applies a regex that accepts typical domain formats with or without `http`, `https`, or `www`. If the pattern matches, the node returns only the core domain (`example.com`). If the string doesnâ€™t match a valid domain format, the node returns `Not Found`. This prevents downstream API calls from failing due to invalid input, also saving on wasted resources.\n\n*Output*:\n- On success: Returns an object with `clean_domain` set to the parsed domain. The workflow continues to enrichment steps.\n\n- On failure: Returns `clean_domain: \"Not Found\"`. The next step detects this and sends a Slack alert to `the n8n-errors` channel. The workflow continues to Phase 2, to enrich the lead, even if this step fails.\n",
        "height": 944,
        "width": 480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        144,
        848
      ],
      "typeVersion": 1,
      "id": "facba93f-975c-4352-a814-a88077ab641c",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## 2. Check if Company Exists in HubSpot\n**Purpose**: To ensure the company does not exist in the CRM, so the workflow does not make unnecessary already-made API calls, wasting resources.\n\n*Input*: The clean domain from the previous step.\n\nChecks if the company exists in HubSpot.\n\n*Output*: \n- It does exist: Skips company enrichment workflow, to avoid duplicating records in the CRM, spending unnecessary resources and making extra API calls.\n- It does **not** exist: Continue with the workflow to enrich the company.\n\n",
        "height": 624,
        "width": 480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        640,
        1168
      ],
      "typeVersion": 1,
      "id": "9ba3e70c-5c73-4ea9-8da7-67e4a3a79527",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## 3. Enrich the Company by Scraping Crunchbase with Bright Data\n**Purpose**: Ensures the Crunchbase scraping job successfully completes by repeatedly checking Bright Dataâ€™s job status until the company snapshot is ready for download.\n\n*Input*: The raw string from the form field named \"Your Company Website\".\n\nThe company website is sent to the Bright Data API as the `keyword` to activate the Crunchbase Scraper, which initiates a search and data collection job for the given company. The API returns a unique `snapshot_id` for this job.\nA loop is started using the `snapshot_id` to check the job status. In each loop iteration:\nThe workflow pauses for 30 seconds to allow the scraper sufficient time to collect the data and respect rate limits.\nAfter the delay, it calls the Bright Data API to fetch the current status of the job (`status`).\nThe loop checks the returned `status`. If the status is `\"ready\"`, the loop is broken, and the flow proceeds. If the status is anything else (e.g., `\"running\"`), the loop continues to the next iteration after the next 30-second delay.\n\n*Output*: \n- On success (`status` == `\"ready\"`): The workflow proceeds to the next node, where it uses the `snapshot_id` to download the comprehensive JSON snapshot containing the enriched company data from Crunchbase (e.g., funding, industry, employee count).\n- On failure: If any of these nodes fails, an external \"Error Flow\" is triggered immediately, which sends a **Slack** message in the error-tracking channel with the timestamp and error information, including last node executed, stack trace, etc.\n\n",
        "height": 688,
        "width": 1168,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1136,
        1104
      ],
      "typeVersion": 1,
      "id": "45856928-4fbe-471d-b2eb-875e0eb3cc46",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## 4. Use JavaScript to Clean Up the Enriched Data and Create Company in HubSpot\n**Purpose**: Produces a sanitized, normalized company profile from the raw Crunchbase data so it can be safely created in HubSpot without errors from missing or inconsistent fields.\n\n*Input*: The raw JSON company data fetched from Crunchbase.\n\nThis script pulls enriched company data from Crunchbase and normalizes it into a clean, predictable output object. It safely handles all array-based fields: `industries`, `builtwith_tech`, and `products_and_services`, by first verifying that each source value is an array before mapping over it. Each mapper guards against missing or malformed fields using optional chaining and fallback defaults, ensuring the final values never break downstream consumers.\n\nBeyond arrays, the code consistently uses optional chaining and empty-string fallbacks for all Crunchbase properties (e.g., `companyName`, `about`, `description`, `industry`, `contact_email`, `ipoStatus`, `numberOfEmployees`, etc.). It also retrieves the previously computed clean domain.\n\nThen, the workflow creates the company in the CRM, HubSpot, including all enriched fields.\n\n*Output*: \n- On success: The final returned object is a fully sanitized, normalized company profile.\n- On failure: If any of the fields are missing, the script accounts for it by replacing the field with an empty string (`|| \"\"`).\n\n",
        "height": 800,
        "width": 528,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2320,
        992
      ],
      "typeVersion": 1,
      "id": "05c473a2-2ca3-4d7d-b403-42bc991c9cf1",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## PHASE 2: Enrich Lead Data with LinkedIn, Add Lead to HubSpot, and Notify Sales Team",
        "height": 944,
        "width": 3056,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -176,
        1824
      ],
      "typeVersion": 1,
      "id": "7a57ed2d-6458-4302-85df-0b879a3f4620",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e462f931-8b61-4903-b63e-ccd5a3e111ab",
              "leftValue": "={{ $json.status }}",
              "rightValue": "ready",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1888,
        1520
      ],
      "id": "3e56f0b9-afca-4d50-b5bd-2755a6a70165",
      "name": "If status == \"ready\""
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 5. Check if Lead Exists in HubSpot\n**Purpose**: Checks HubSpot for an existing lead record using the submitted email to determine whether enrichment should run or be skipped.\n\n*Input*: The raw string from the form field named \"Work Email\".\n\nUsing the lead's email, filters any existing records in the CRM  HubSpot.\n\n*Output*: \n- If the output is empty: Continue with the workflow as lead does not exist in the CRM.\n- If the output is not empty: A record exists in HubSpot that matches the lead's email. Skips the enrichment phase to avoid re-using resources since lead has already been enriched. Instead, fetch existing contact from the CRM and execute the last step from this phase: notifying the sales team via **Slack** that an existing lead has re-submitted the contact form.",
        "height": 848,
        "width": 464,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        144,
        1904
      ],
      "typeVersion": 1,
      "id": "7e9df852-1c3e-40ef-ba2f-a23fd68ab9bc",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "authentication": "appToken",
        "operation": "search",
        "limit": 10,
        "filterGroupsUi": {
          "filterGroupsValues": [
            {
              "filtersUi": {
                "filterValues": [
                  {
                    "propertyName": "email|string",
                    "value": "={{ $(\"Webhook: Contact Form New Submission\").first().json.body[\"Work Email\"] }}"
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "properties": [
            "firstname",
            "lastname",
            "email",
            "jobtitle",
            "company",
            "lead_score",
            "hs_linkedin_url",
            "phone",
            "seniority",
            "city"
          ]
        }
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        224,
        2160
      ],
      "id": "6ebebd81-e2e6-46c6-928c-d500f1c833db",
      "name": "Fetch Existing Contact",
      "credentials": {
        "hubspotAppToken": {
          "id": "1BqCKopW0EpSuix8",
          "name": "HubSpot - 02/11/2025"
        }
      }
    },
    {
      "parameters": {
        "content": "## 0. TRIGGER: Contact Owner is Assigned in HubSpot\n- The webhook is triggered when the \"Contact Owner\" property changes for any contact objects in HubSpot.",
        "height": 432,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -160,
        3088
      ],
      "typeVersion": 1,
      "id": "f23e9170-40c9-452c-b7e7-ee2a2d70cacc",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 6. Enrich Lead by Scraping their LinkedIn with Bright Data\n**Purpose**:\n\n*Input*: The raw string from the form field named \"Your LinkedIn URL\".\n\nThe lead's LinkedIn is sent to the Bright Data API as the `url` to activate the LinkedIn Scraper, which initiates a search and data collection job for the given lead. The API returns a unique `snapshot_id` for this job.\nA loop is started using the `snapshot_id` to check the job status. In each loop iteration:\nThe workflow pauses for 30 seconds to allow the scraper sufficient time to collect the data and respect rate limits.\nAfter the delay, it calls the Bright Data API to fetch the current status of the job (`status`).\nThe loop checks the returned `status`. If the status is `\"ready\"`, the loop is broken, and the flow proceeds. If the status is anything else (e.g., `\"running\"`), the loop continues to the next iteration after the next 30-second delay.\n\n*Output*: \n- On success (`status` == `\"ready\"`): The workflow proceeds to the next node, where it uses the `snapshot_id` to download the comprehensive JSON snapshot containing the enriched lead data from LinkedIn (e.g., current company, years of experience, latest LinkedIn activity...).\n- On failure: If any of these nodes fails, an external \"Error Flow\" is triggered immediately, which sends a **Slack** message in the error-tracking channel with the timestamp and error information, including last node executed, stack trace, etc.",
        "height": 704,
        "width": 1088,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        1904
      ],
      "typeVersion": 1,
      "id": "8a3b890e-209b-4503-88ce-4cc597c72aef",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 7. Score Lead with JavaScript and Create Contact in HubSpot\n**Purpose**: Calculates a unified `0â€“100` lead score using form inputs and LinkedIn enrichment data, so the workflow can classify the contact by value, urgency, and buying intent before adding them to the CRM.\n\n*Input*: Raw form fields from the Contact Us submission plus enriched LinkedIn profile data, job history, activity, and location.\n\nThe script extracts user-entered answers and LinkedIn data, normalizes them, and applies weighted scoring rules across six categories: location, job role, seniority, product interest, challenge text, and engagement. It parses years of experience from LinkedIn, validates arrays, checks for executive titles, identifies urgency and pain-point signals in the challenge description, evaluates industry relevance, and accumulates points accordingly. It tracks partial scores and reasons for transparency, then assigns a final tier (Decision Maker, High Value, Warm Lead, Cold Lead, or Unqualified). Finally, it returns a structured object containing all raw fields, enriched data, parsed scoring components, flags, and the final score.\n\n*Output*:\n- On success: Returns a complete lead profile with all fields, parsed experience, scoring details, and assigned tier for downstream CRM creation of the contact.\n- On failure: Missing or malformed fields are automatically replaced with empty strings or safe defaults, ensuring the workflow never breaks and always returns a valid object.",
        "height": 784,
        "width": 576,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1728,
        1904
      ],
      "typeVersion": 1,
      "id": "d7fb94ba-2310-407f-8ce7-ebcc8e0e0dc9",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## 8. Create Task in Asana for Sales Team and Notify via Slack Message\n**Purpose**: Creates an Asana task and Slack notification to ensure the sales team is alerted and assigns CRM ownership within 48 hours of a new lead submission.\n\nCreates a new task in Asana for the sales team to assign a contact owner in the CRM no later than 48 hours from the form submission time. The task links directly to the HubSpot contact object for fast ownership, and the workflow also sends a **Slack** summary containing all enriched company and lead details so the team can take immediate action.\n\n*Output*:\n- On success: Asana task is created, linked to the HubSpot record, and a Slack notification is delivered with the full lead and company summary.\n- On failure: If any node fails, an external \"Error Flow\" is triggered that sends a **Slack** message to the error-tracking channel with the timestamp, node name, and stack trace.",
        "height": 656,
        "width": 528,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2320,
        1904
      ],
      "typeVersion": 1,
      "id": "4ab06188-6f04-4544-a069-c07ffced3f86",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09P95PMU0N",
          "mode": "list",
          "cachedResultName": "new-inbound-leads"
        },
        "text": "=A lead has filled out our \"Contact Us\" form!\n\n{{ $('Webhook: Contact Form New Submission').first().json.body['First Name'] + \" \" + $('Webhook: Contact Form New Submission').first().json.body['Last Name']}} just submitted the \"Contact Us\" form. I have added the contact to HubSpot, here's some information about them...\n*Current Company*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.currentCompany + \" (\" + $('Aggregate & Give Lead a Score (0-100)').item.json.companyWebsite + \")\"}}\n*Job Title*: {{ $('Aggregate & Give Lead a Score (0-100)').first().json.jobTitle }}\n*Years At Company*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.totalYearsAtCompany }}\n*City*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.city }}\n*Work Email*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.workEmail }}\n*Phone Number*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.phoneNumber }}\n*LinkedIn URL*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.linkedinURL }}\n*Interested In*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.productInterest }}\n*What is their challenge/goal?*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.challengeText }}\n*Lead Score*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.totalLeadScore }}\n*Contact Tier*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.contactTier }}\n*Lead Score Reasoning*: {{ $('Aggregate & Give Lead a Score (0-100)').item.json.scoreReasons }}\n\nI have also added {{ $('Aggregate Enriched Company Data').item.json.companyName }} to HubSpot, check them out...\n*Company Domain*: {{ $('Aggregate Enriched Company Data').item.json.companyDomain }}\n*Country*: {{ $('Aggregate Enriched Company Data').item.json.country }}\n*About*: {{ $('Aggregate Enriched Company Data').item.json.about }}\n*Industry*: {{ $('Aggregate Enriched Company Data').item.json.industry }}\n*Number of Employees*: {{ $('Aggregate Enriched Company Data').item.json.numberOfEmployees }}\n*Email*: {{ $('Aggregate Enriched Company Data').item.json.email }}\n*Phone Number*: {{ $('Aggregate Enriched Company Data').item.json.phone }}\n\n\n*Next Steps*:\n----- New Asana task created: {{ $json.permalink_url }}! -----\nDue on {{ $json.due_on }}: \nAssign a contact owner in HubSpot -> https://app-na2.hubspot.com/contacts/{{ $('Create or Update a Contact in HubSpot').item.json['portal-id'] }}/record/0-1/{{ $('Create or Update a Contact in HubSpot').item.json.vid }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        2624,
        1936
      ],
      "id": "ee47cf0c-444d-4776-aed6-a3830cb140d0",
      "name": "Send New Lead to Sales Channel",
      "webhookId": "54be6522-b0fa-419c-92a9-e9b13095cc15",
      "credentials": {
        "slackApi": {
          "id": "mkWLWUFV2SEuHOTp",
          "name": "n8n Slack - 3/11/2025"
        }
      }
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09P95PMU0N",
          "mode": "list",
          "cachedResultName": "new-inbound-leads"
        },
        "text": "=An existing lead has submitted the \"Contact Us\" form!\n\n{{ $('Webhook: Contact Form New Submission').first().json.body['First Name'] + \" \" + $('Webhook: Contact Form New Submission').first().json.body['Last Name']}} just submitted the \"Contact Us\" form. This contact already exists in HubSpot, here's some information about them...\n*Job Title*: {{ $json.properties.jobtitle }}\n*Years At Company*: {{ $json.properties.seniority }}\n*City*: {{ $json.properties.city }}\n*Work Email*: {{ $(\"Webhook: Contact Form New Submission\").first().json.body[\"Work Email\"] }}\n*Phone Number*: {{ $json.properties.phone }}\n*LinkedIn URL*: {{ $json.properties.hs_linkedin_url }}\n*Company Domain*: {{ $('Extract Company Domain').first()?.json?.clean_domain || \"\" }}\n\n*Next Steps*:\nRe-engage the contact to address the new information provided in the form:\n*Interested In*: {{$(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Which product area are you most interested in? \"] || \"\" }}\n*What is their challenge/goal?*: {{ $(\"Webhook: Contact Form New Submission\").first()?.json?.body[\"Tell us about your primary challenge or goal:\"].toLowerCase() || \"\" }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        416,
        2160
      ],
      "id": "14623096-984f-4c58-af38-edaba0b0490a",
      "name": "Notify Sales Team",
      "webhookId": "72b2f209-0764-4c7c-8b5e-c0548b5216a9",
      "credentials": {
        "slackApi": {
          "id": "iIYeGporEkwdmZlX",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "content": "## How to Turn a â€œContact Usâ€ Form Submission Into a Fully Automated Lead Enrichment System\n### Technologies used: \n- *HubSpot* as the CRM\n- *Crunchbase* and *Bright Data* for scraping\n- *JavaScript* for cleaning and transforming data\n- *Google Gemini* for personalized email generation\n- *Slack* and *Gmail* for communications\n- *Asana* for task management\n\n## This system turns inbound leads from simple form submissions into fully qualified, enriched, and ready-to-outreach contacts, all without manual intervention. By combining company and lead enrichment, automated scoring, and AI-generated outreach, sales and marketing teams eliminate tedious research, reduce response times, and increase conversion by booking calls with warm leads immediately.\n### This automation was created by *Ingrid Coll*. See my other projects on GitHub at [github.com/ingridcoll](https://github.com/ingridcoll) or send me a LinkedIn message at [linkedin.com/in/ingridcoll](https://www.linkedin.com/in/ingridcoll/) with any questions or business inquiries!\n\n## In PHASE 1: Company Enrichment...\n### A simple company website field is turned into a fully validated, enriched company profile, automatically synced with the CRM.\nAutomatically extracts and standardizes the company website.\nStops enrichment if the company already exists in the CRM.\nLaunches Crunchbase scraping via Bright Data API.\nProvides verified, structured company information: **name industry, size, funding, products, and technologies used**.\nEliminates manual research and ensures no wasted enrichment cycles.\nEnables sales and marketing teams to quickly understand the leadâ€™s company, prioritize opportunities, and make fast decisions.\n## In PHASE 2: Lead Enrichment...\n### The inbound lead becomes a fully enriched, outreach-ready contact.\nPulls LinkedIn data including job title, current company, location, experience, education, certifications, and recent activity.\nCleans and structures arrays and text fields, with fallbacks for missing or malformed data.\nApplies a weighted lead scoring model based on location, role, seniority, product interest, goals, and engagement signals.\nDelivers a complete, accurate lead profile and adds it to the CRM.\nHighlights decision-makers and high-value prospects automatically.\nNotifies the sales team by creating an Asana task and sending a message via Slack.\n## In PHASE 3: Personalized Outreach Automation...\n### Turns enriched lead and company data into a ready-to-send, highly personalized email for the assigned contact owner.\nAutomatically fetches the lead and company profile from HubSpot once a contact owner is assigned.\nUses Google Gemini AI to craft a tailored email based on the leadâ€™s profile, interests, challenges, and company context. It even takes into account the latest LinkedIn activity to reference recently-liked posts!\nVerifies the contact ownerâ€™s availability to suggest meeting times.\nCreates a Gmail draft pre-populated with the personalized email and meeting options, ready for quick review and send.\nProvides a fully personalized, high-conversion email without manual drafting.\nSaves the sales team time while increasing engagement quality.\nEnsures outreach is timely, relevant, and aligned with the contact ownerâ€™s schedule, boosting the likelihood of booking meetings and advancing leads.\n",
        "height": 1152,
        "width": 1008,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1184,
        768
      ],
      "typeVersion": 1,
      "id": "e5607f10-dba2-4042-97fd-3f8a62e5542b",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "## PHASE 3: Generate Meeting Invite and Personalized Email for New Lead",
        "height": 944,
        "width": 3056,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -176,
        2768
      ],
      "typeVersion": 1,
      "id": "7f5037a9-e02f-47d9-8f20-bb53516c6988",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## 1.  Check if Lead Exists in HubSpot\n**Purpose**: Checks HubSpot for an existing lead record using the submitted email to determine whether enrichment should run or be skipped.\n\n*Input*: The raw string from the form field named \"Work Email\".\n\nUsing the lead's email, filters any existing records in the CRM  HubSpot.\n\n*Output*: \n- If the output is empty: Continue with the workflow as lead does not exist in the CRM.\n- If the output is not empty: A record exists in HubSpot that matches the lead's email. Skips the enrichment phase to avoid re-using resources since lead has already been enriched. Instead, fetch existing contact from the CRM and execute the last step from this phase: notifying the sales team via **Slack** that an existing lead has re-submitted the contact form.",
        "height": 640,
        "width": 720,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        144,
        2864
      ],
      "typeVersion": 1,
      "id": "4c224d87-4e85-41f1-ab7e-6b5e9bb76279",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "# AI-Powered Personalized Inbound Lead Enrichment Automation with n8n\n",
        "height": 80,
        "width": 4080,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1184,
        688
      ],
      "typeVersion": 1,
      "id": "c70f7b50-e2ca-41d5-b86f-44e0a9841e9e",
      "name": "Sticky Note15"
    }
  ],
  "pinData": {},
  "connections": {
    "Create or Update a Contact in HubSpot": {
      "main": [
        [
          {
            "node": "Create Task For Sales Team",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Check If Lead Already Exists in HubSpot": {
      "main": [
        [
          {
            "node": "Contact Does Not Exist in HubSpot?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check If Company Already Exists": {
      "main": [
        [
          {
            "node": "Company Does Not Exist in HubSpot?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contact Does Not Exist in HubSpot?": {
      "main": [
        [
          {
            "node": "Scrape Lead's LinkedIn with BrightData",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fetch Existing Contact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape Lead's LinkedIn with BrightData": {
      "main": [
        [
          {
            "node": "Wait 30 Secs",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "If Status == Ready": {
      "main": [
        [
          {
            "node": "Get Lead's LinkedIn Results",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait 30 Secs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead's LinkedIn Results": {
      "main": [
        [
          {
            "node": "Aggregate & Give Lead a Score (0-100)",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Check Scraping Process Status": {
      "main": [
        [
          {
            "node": "If Status == Ready",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Extract Company Domain": {
      "main": [
        [
          {
            "node": "Valid Company Domain?",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Valid Company Domain?": {
      "main": [
        [
          {
            "node": "Check If Company Already Exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error: Validating Company Domain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Company Does Not Exist in HubSpot?": {
      "main": [
        [
          {
            "node": "Enrich Company with Crunchbase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check If Lead Already Exists in HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enrich Company with Crunchbase": {
      "main": [
        [
          {
            "node": "Wait 30 Seconds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Crunchbase Enrichment Status": {
      "main": [
        [
          {
            "node": "If status == \"ready\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Company Enrichment Data": {
      "main": [
        [
          {
            "node": "Aggregate Enriched Company Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Company on HubSpot": {
      "main": [
        [
          {
            "node": "Check If Lead Already Exists in HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate & Give Lead a Score (0-100)": {
      "main": [
        [
          {
            "node": "Create or Update a Contact in HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error: Validating Company Domain": {
      "main": [
        []
      ]
    },
    "Aggregate Enriched Company Data": {
      "main": [
        [
          {
            "node": "Create Company on HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Task For Sales Team": {
      "main": [
        [
          {
            "node": "Send New Lead to Sales Channel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HubSpot Trigger: CSR Assigned to Contact": {
      "main": [
        [
          {
            "node": "Contact Owner Assigned?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get CSR from HubSpot": {
      "main": [
        [
          {
            "node": "Get Lead from HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contact Owner Assigned?": {
      "main": [
        [
          {
            "node": "Get CSR from HubSpot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead from HubSpot": {
      "main": [
        [
          {
            "node": "Aggregate Lead and Company Enriched Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Lead and Company Enriched Data": {
      "main": [
        [
          {
            "node": "Aggregate All Data in One Field",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate All Data in One Field": {
      "main": [
        [
          {
            "node": "AI Email Crafter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Email Crafter": {
      "main": [
        [
          {
            "node": "Check CSR's Next 2 Weeks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Email Crafter",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Send Draft Email to CSR": {
      "main": [
        []
      ]
    },
    "Initialize Available Meeting Time (9-5)": {
      "main": [
        [
          {
            "node": "Send Draft Email to CSR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check CSR's Next 2 Weeks": {
      "main": [
        [
          {
            "node": "Initialize Available Meeting Time (9-5)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Contact Form New Submission": {
      "main": [
        [
          {
            "node": "Extract Company Domain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 30 Seconds": {
      "main": [
        [
          {
            "node": "Check Crunchbase Enrichment Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 30 Secs": {
      "main": [
        [
          {
            "node": "Check Scraping Process Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If status == \"ready\"": {
      "main": [
        [
          {
            "node": "Get Company Enrichment Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait 30 Seconds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Existing Contact": {
      "main": [
        [
          {
            "node": "Notify Sales Team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send New Lead to Sales Channel": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "xPqjLP4SwVqkl7Pp",
    "timeSavedPerExecution": 60
  },
  "versionId": "d3ca158c-0fb8-4c07-994f-c835bc053faf",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ca03a50f3e97177370433a188f6312cc939b6d1e7d448aed34a8b7e378e60166"
  },
  "id": "O0ewwBSJJjruWefv",
  "tags": [
    {
      "updatedAt": "2025-11-05T16:22:35.972Z",
      "createdAt": "2025-11-05T16:22:35.972Z",
      "id": "0dXkkAoaFyWqV55Y",
      "name": "Onboarding"
    },
    {
      "updatedAt": "2025-11-05T17:15:48.295Z",
      "createdAt": "2025-11-05T17:15:48.295Z",
      "id": "0eqsEBt8CDaT83vy",
      "name": "RevOps"
    },
    {
      "updatedAt": "2025-11-05T16:22:22.644Z",
      "createdAt": "2025-11-05T16:22:22.644Z",
      "id": "3W5sznRygBUxlSc7",
      "name": "Sales"
    },
    {
      "updatedAt": "2025-11-05T16:22:40.826Z",
      "createdAt": "2025-11-05T16:22:40.826Z",
      "id": "3oj1OaX5tA7TOffg",
      "name": "Lead Enrichment"
    },
    {
      "updatedAt": "2025-11-05T17:15:25.406Z",
      "createdAt": "2025-11-05T17:15:25.406Z",
      "id": "Jb9Gk1FWalh85H0j",
      "name": "Company Enrichment"
    }
  ]
}